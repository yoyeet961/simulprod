(function(n){typeof define=="function"&&define.amd?define(n):window.purl=n()})(function(){function c(n,t){for(var u=decodeURI(n),e=h[t||!1?"strict":"loose"].exec(u),i={attr:{},param:{},seg:{}},r=14;r--;)i.attr[o[r]]=e[r]||"";return i.param.query=f(i.attr.query),i.param.fragment=f(i.attr.fragment),i.seg.path=i.attr.path.replace(/^\/+|\/+$/g,"").split("/"),i.seg.fragment=i.attr.fragment.replace(/^\/+|\/+$/g,"").split("/"),i.attr.base=i.attr.host?(i.attr.protocol?i.attr.protocol+"://"+i.attr.host:i.attr.host)+(i.attr.port?":"+i.attr.port:""):"",i}function l(n){var t=n.tagName;return typeof t!="undefined"?e[t.toLowerCase()]:t}function u(n,t){var i,r;if(n[t].length===0)return n[t]={};i={};for(r in n[t])i[r]=n[t][r];return n[t]=i,i}function r(t,f,e,o){var h=t.shift(),s;h?(s=f[e]=f[e]||[],"]"==h?n(s)?""!==o&&s.push(o):"object"==typeof s?s[w(s).length]=o:s=f[e]=[f[e],o]:~h.indexOf("]")?(h=h.substr(0,h.length-1),!i.test(h)&&n(s)&&(s=u(f,e)),r(t,s,h,o)):(!i.test(h)&&n(s)&&(s=u(f,e)),r(t,s,h,o))):n(f[e])?f[e].push(o):f[e]="object"==typeof f[e]?o:"undefined"==typeof f[e]?o:[f[e],o]}function a(t,u,f){var s,e,o;if(~u.indexOf("]"))s=u.split("["),r(s,t,"base",f);else{if(!i.test(u)&&n(t.base)){e={};for(o in t.base)e[o]=t.base[o];t.base=e}u!==""&&v(t.base,u,f)}return t}function f(n){return p(String(n).split(/&|;/),function(n,t){try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(e){}var u=t.indexOf("="),f=y(t),r=t.substr(0,f||u),i=t.substr(f||u,t.length);return i=i.substr(i.indexOf("=")+1,i.length),r===""&&(r=t,i=""),a(n,r,i)},{base:{}}).base}function v(t,i,r){var u=t[i];typeof u=="undefined"?t[i]=r:n(u)?u.push(r):t[i]=[u,r]}function y(n){for(var u=n.length,r,t,i=0;i<u;++i)if(t=n[i],"]"==t&&(r=!1),"["==t&&(r=!0),"="==t&&!r)return i}function p(n,t){for(var i=0,u=n.length>>0,r=arguments[2];i<u;)i in n&&(r=t.call(undefined,r,n[i],i,n)),++i;return r}function n(n){return Object.prototype.toString.call(n)==="[object Array]"}function w(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t}function t(n,t){return arguments.length===1&&n===!0&&(t=!0,n=undefined),t=t||!1,n=n||window.location.toString(),{data:c(n,t),attr:function(n){return n=s[n]||n,typeof n!="undefined"?this.data.attr[n]:this.data.attr},param:function(n){return typeof n!="undefined"?this.data.param.query[n]:this.data.param.query},fparam:function(n){return typeof n!="undefined"?this.data.param.fragment[n]:this.data.param.fragment},segment:function(n){return typeof n=="undefined"?this.data.seg.path:(n=n<0?this.data.seg.path.length+n:n-1,this.data.seg.path[n])},fsegment:function(n){return typeof n=="undefined"?this.data.seg.fragment:(n=n<0?this.data.seg.fragment.length+n:n-1,this.data.seg.fragment[n])}}}var e={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href",embed:"src",object:"data"},o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],s={anchor:"fragment"},h={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},i=/^[0-9]+$/;return t.jQuery=function(n){n!=null&&(n.fn.url=function(i){var r="";return this.length&&(r=n(this).attr(l(this[0]))||""),t(r,i)},n.url=t)},t.jQuery(window.jQuery),t});angular.module("DevOpsApp",["ngGrid"]);angular.module("DevOpsApp").factory("pageModel",["$window",function(n){"use strict";var t,i;return t=function(){if(!angular.isDefined(n.PageModel)||!angular.isDefined(n.PageModel.ConfigTypeList))throw new Error("PageModel.ConfigTypeList is not defined");return n.PageModel.ConfigTypeList},i=function(){if(!angular.isDefined(n.PageModel)||!angular.isDefined(n.PageModel.EnvironmentList))throw new Error("PageModel.EnvironmentList is not defined");return n.PageModel.EnvironmentList},{getConfigTypes:t,getEnvironments:i}}]);angular.module("DevOpsApp").factory("preemptibleWatcher",function(){"use strict";var n=function(n,t){var i,u,r,e,f,o=angular.equals,s,h;return u=n.$eval(t),r=angular.copy(u),n.$watch(t,function(n,t){n!==t&&(o(n,r)||(r=angular.copy(n),angular.isFunction(f)&&f.call(null,n,t)))},!0),h=function(n){return $.each(n,function(n,t){if(angular.isDefined(i[n]))throw new Error("mutator '"+n+"' is already defined");i[n]=function(){var n=Array.prototype.slice.call(arguments);return n.unshift(r,u),t.apply(null,n)}}),i},e=function(n){return f=n,i},s=function(n){return o=n,i},i={onChange:e,mutators:h,compareWith:s}};return{create:function(t,i){return new n(t,i)}}});angular.module("DevOpsApp").factory("diffFetcher",["$http","$q",function(n,t){"use strict";var r,i=!1;return r=function(r){var u,f,e;return u={success:function(n){return f=n,u},error:function(n){return e=n,u}},i!==!1&&(i.resolve(),i=!1),i=t.defer(),n({method:"post",url:"GetDiffData",data:r,timeout:i}).success(function(){i=!1;angular.isFunction(f)&&f.apply(null,arguments)}).error(function(){i=!1;angular.isFunction(e)&&e.apply(null,arguments)}),u},{fetchDiff:r}}]);angular.module("DevOpsApp").controller("DeployedVersionsDiffCtrl",["$scope","$timeout","pageModel","preemptibleWatcher","diffFetcher",function(n,t,i,r,u){"use strict";var v=1,y,h,o,s,c,p={},w,b,e,l,a,f;a={Identical:0,Different:1,Missing:2,"0":"Identical","1":"Different","2":"Missing"};y='<div ng-class="getCompareCellClass(row.getProperty(col.field).CompareType)"><div class="ngCellText" ng-class="col.colIndex()" ng-attr-title="{{getCompareCellContents(row.getProperty(col.field))}}" ng-bind="getCompareCellContents(row.getProperty(col.field))"><\/div><\/div>';h='<div class="ngCellText" ng-class="col.colIndex()" ng-attr-title="{{row.getProperty(col.field)}}"><span ng-cell-text>{{row.getProperty(col.field)}}<\/span><\/div>';n.environments=i.getEnvironments();$.each(n.environments,function(n,t){p[t.ID]=t.Name});n.columnDefs=[{field:"displayName",displayName:"Name",cellTemplate:h},{field:"primaryEnv",cellTemplate:h,visible:!1}];$.each(n.environments,function(t,i){n.columnDefs.push({field:"env_"+i.ID,displayName:i.Name,cellTemplate:y,visible:!1,compareEnvId:i.ID})});n.sortInfo={columns:[],fields:[],directions:[]},function(){var t=1;n.filterOptions={primaryEnvironmentID:function(i){return angular.isDefined(i)&&(t=i,o(n.filterOptions.compareEnvironmentIDs,t)),t},compareEnvironmentIDs:[9,13],options:{ShowIdentical:!1},filterText:null,useExternalFilter:!0}}();n.pagingOptions={pageSizes:[25,50,100,250,1e3],pageSize:100,currentPage:1};n.gridData=null;n.viewModel={isLoaded:!1,isFetching:!1,totalServerItems:0,message:{text:!1,type:""}};n.warning=function(n){s("warning",n);c()};n.error=function(n){s("error",n);c()};n.isCompareEnvironmentChecked=function(t){return!n.isCompareEnvironmentCheckDisabled(t)&&-1<n.filterOptions.compareEnvironmentIDs.indexOf(t)};n.isCompareEnvironmentCheckDisabled=function(t){return n.filterOptions.primaryEnvironmentID()===t};n.toggleCompareEnvironment=function(t){o(n.filterOptions.compareEnvironmentIDs,t)||n.filterOptions.compareEnvironmentIDs.push(t)};n.getCompareCellContents=function(n){return n.CompareType===a.Missing?"Missing":n.Values.sort().join(", ")};n.getCompareCellClass=function(n){return"compare-type-"+a[n].toLowerCase()};n.fetchData=function(){if(n.filterOptions.compareEnvironmentIDs.length===0){n.warning("You must select at least one environment to compare with.");return}n.pagingOptions.currentPage!==1&&f.setCurrentPage(1);e()};n.gridOptions={data:"gridData",enablePaging:!0,showFooter:!0,totalServerItems:"viewModel.totalServerItems",pagingOptions:n.pagingOptions,filterOptions:n.filterOptions,plugins:[new ngGridFlexibleHeightPlugin],columnDefs:"columnDefs",enableColumnResize:!0,sortInfo:n.sortInfo,useExternalSorting:!0};o=function(n,t){for(var i=!1,r;-1<(r=n.indexOf(t));)i=!0,n.splice(r,1);return i};s=function(t,i){n.viewModel.message.type=t;n.viewModel.message.text=i};c=function(){t(function(){s("","")},4500)};w=function(t){var i;n.viewModel.totalServerItems=t.TotalMatchingItems;n.viewModel.mostRecentlyUpdated=t.MostRecentlyUpdated;n.gridData=[];t.PagedItems.length!==0&&(n.columnDefs[v].displayName=p[n.filterOptions.primaryEnvironmentID()],n.columnDefs[v].visible=!0,$.each(n.columnDefs,function(t,i){typeof i.compareEnvId!="undefined"&&(i.visible=-1<n.filterOptions.compareEnvironmentIDs.indexOf(i.compareEnvId))}),$.each(t.PagedItems,function(t,r){var u=[];r.PrimaryEnvironmentValues.sort();$.each(r.PrimaryEnvironmentValues,function(n,t){u.push(t?t:"[EMPTY VERSION]")});i={displayName:r.DisplayName,primaryEnv:u.join(", ")};$.each(r.ComparedEnvironmentsValues,function(n,t){i["env_"+n]=t});n.gridData.push(i)}));n.viewModel.isFetching=!1};b=function(){var i=0,t,r,u,s=$.url().param();if($.each(s,function(e,o){++i;switch(e){case"pageNumber":f.setCurrentPage(parseInt(o));break;case"pageSize":f.setPageSize(parseInt(o));break;case"sortColumn":t=o;break;case"sortComparedColumnEnvironmentID":r=o;break;case"sortDirection":u=o==="desc";break;case"primaryEnvironmentID":n.filterOptions.primaryEnvironmentID(parseInt(o));break;case"compareEnvironmentIDs":n.filterOptions.compareEnvironmentIDs=[];$.each(o,function(t,i){n.filterOptions.compareEnvironmentIDs.push(parseInt(i))});break;case"options":n.filterOptions.options.ShowIdentical=o.ShowIdentical==="true";break;case"filterText":n.filterOptions.filterText=o;break;default:--i}}),i>0){if(typeof t=="string"&&(t==="comparedEnv"&&(t="env_"+r),l.sortBy(t,u)),o(n.filterOptions.compareEnvironmentIDs,n.filterOptions.primaryEnvironmentID()),n.filterOptions.compareEnvironmentIDs.length===0){n.warning("No valid environments to compare with were passed in the URL.");return}e()}};e=function(){var t,i;n.viewModel.isFetching=!0;t={primaryEnvironmentID:n.filterOptions.primaryEnvironmentID(),compareEnvironmentIDs:n.filterOptions.compareEnvironmentIDs,options:n.filterOptions.options,pageSize:n.pagingOptions.pageSize,pageNumber:n.pagingOptions.currentPage,filterText:n.filterOptions.filterText};n.sortInfo.columns.length>0&&(i=n.sortInfo.columns[0],t.sortColumn=i.field,typeof i.colDef.compareEnvId!="undefined"&&(t.sortColumn="comparedEnv",t.sortComparedColumnEnvironmentID=i.colDef.compareEnvId),t.sortDirection=n.sortInfo.directions[0]);history.replaceState(null,null,"?"+$.param(t));u.fetchDiff(t).success(function(t){n.viewModel.isFetching=!1;w(t)}).error(function(){n.viewModel.isFetching=!1;n.error("An error occurred when connecting to the server.")})};f=r.create(n,"pagingOptions");f.onChange(function(){e()}).mutators({setCurrentPage:function(n,t,i){n.currentPage=t.currentPage=i},setPageSize:function(n,t,i){n.pageSize=t.pageSize=i}});l=r.create(n,"sortInfo");l.onChange(function(){n.pagingOptions.currentPage!=1&&f.setCurrentPage(1);e()}).mutators({sortBy:function(t,i,r,u){u=u||!1;t.fields=[r];t.directions=[u?"desc":"asc"];n.gridOptions.sortBy(r);u&&n.gridOptions.sortBy(r)}}).compareWith(function(n,t){return angular.equals(n.fields,t.fields)&&angular.equals(n.directions,t.directions)}),function(){var t=setInterval(function(){$("div[ng-grid-footer]").length>0&&($(".ngGrid").prepend($("div[ng-grid-footer]")[0]),$(".ngFooterSelectedItems").css("display","none"),n.viewModel.isLoaded=!0,clearInterval(t))},50)}();setTimeout(b,100)}])