typeof Roblox=="undefined"&&(Roblox={});Roblox.deploymentActions=function(){"use strict";var n={Validated:"Are you sure you want to proceed with deployment to the rest of the servers?",RollBack:"Are you sure you want to roll back this deployment?",RetryFailures:"Are you sure you want to retry failure(s) for this deployment?",Abort:"Are you sure you want to abort this deployment?",ConfirmEnqueueDeployment:"Are you sure you want to enqueue the deployment?",SelectEnvironmentToDeploy:"Please select a target environment to deploy",SelectEnvironmentFirst:"[ Select environment first ]",ServersLoading:"[ Loading servers... ]",ConfirmRedoDeployment:"Are you sure you want to re-queue this deployment?",ConfirmPatch:"Are you sure you want to create a release branch from this deployment?",ValidatedCanaries:"Are you sure you want to proceed with deployment to the rest of the servers?"},t=function(t,i,r){var o=t.closest("tr"),s=o.data("id"),u=t.data("status"),f=n[u],e=t.data("extra-message");e&&(f+="<br><br>"+e);bootbox.confirm(f,function(n){if(n){var t="/Deployments/UpdateStatus?id="+s+"&status="+u;$.post(t).done(i).fail(r)}})},i=function(t,i,r){var u=t.closest("tr"),f=u.data("id");bootbox.confirm(n.ConfirmRedoDeployment,function(n){if(n){var t="/Deployments/Redo?id="+f;$.post(t).done(i).fail(r)}})},r=function(t,i,r){var u=t.closest("tr"),f=u.data("id");bootbox.confirm(n.ConfirmPatch,function(n){if(n){var t="/Deployments/Patch?id="+f;$.post(t).done(i).fail(r)}})};return{currentDeploymentUpdate:t,redoDeploymentUpdate:i,createReleaseBranch:r}}();$(function(){"use strict";function r(n,t,i){bootbox.alert("An error has occured: "+i)}function a(){var t=i.data("url"),n=$.ajax(t,{cache:!1});n.done(function(n){i.html(n)});n.fail(function(){i.text("Error while loading deployments")})}function v(){$.getJSON("/Deployments/GetClientPlatformLockHolder",function(n){dt.html(n.ClientLockTaken?n.ClientLockHolder+" has the client lock on the admin site!":"");gt.html(n.PlatformLockTaken?n.PlatformLockHolder+" has the platform lock on the admin site!":"");var i=t.val(),r=(n.ClientLockTaken||n.PlatformLockTaken)&&parseInt(i)===ft.Production;r?ut.collapse("show"):ut.collapse("hide")})}function ii(n,t,i){var r="/Deployments/GetComponentBuildsByBranchAndComponent?branchId="+n+"&componentId="+t;$.getJSON(r,i)}function ri(n,t,i){var r="/Deployments/GetComponentReleasesByBranchAndComponent?branchId="+n+"&componentId="+t;$.getJSON(r,i)}function ui(n,t){var i="/Deployments/GetComponentsByServerGroup?serverGroupId="+n;$.getJSON(i,t)}function et(n,t,i,r){var u="/Deployments/GetTestStatusData?buildValue="+n+"&branchId="+t+"&componentId="+i;$.getJSON(u,r)}function fi(n,t,i){if(n===0){i([{Id:0,Name:"[ Select environment first ]"}]);return}var r="/Deployments/GetServersByEnvironmentAndComponent?environmentId="+n+"&componentId="+t;$.getJSON(r,i)}function u(n,t){t.html("");$.each(n,function(n,i){var u="",f="",r;switch(i.Status){case"Success":f=`${i.TestEnvironment} Component Test Passing`;u=" ✔️";break;case"Failure":f=`${i.TestEnvironment} Component Test Failing`;u=" ❌";break;default:f="Component Test Missing";u=""}r=document.createElement("option");r.value=i.Id;r.title=f;r.text=i.Name+u;t.append(r)})}function y(n){var i,t;n==""?(tt.html(""),it.html("")):(i=n.Status!="Missing"?`Component Test Status: ${n.Status} on ${n.TestEnvironment}`:`Component Test Status: ${n.Status}`,tt.html(i),t=document.createElement("a"),t.href=n.TestLink,t.text=n.TestLink,t.target="_blank",it.html(t))}function ot(){var t=n.val(),i=e.val();ii(i,t,function(n){if(n.hasOwnProperty("error")){var r=s.children("span");r.text(`ERROR: failed to retrieve builds from Artifactory: ${n.error}`);s.show();return}s.hide();u(n,o);n.length>0?et(n[0].Name,i,t,function(n){y(n)}):y("")})}function ei(){const n=e.val();parseInt(n)===ti.PullRequest?d.each(function(){$(this).text()==="SiteTest3"?$(this).prop("selected",!0).trigger("change"):$(this).prop("disabled",!0)}):d.each(function(){$(this).prop("disabled",!1)})}function st(){var t=n.val(),i=k.val();ri(i,t,function(n){u(n,pt)})}function oi(){var t=b.val();ui(t,function(t){u(t,n);p()})}function ht(t,i){var r=t.val(),f=n.val();u([{Id:0,Name:"[ Loading servers... ]"}],i);fi(r,f,function(n){u(n,i)})}function ct(){ht(g,vt)}function lt(){ht(t,yt)}function p(){ct();lt();ot();st()}function f(n){n.Success?(h.html(n.Message),h.addClass("in"),setTimeout(a,1100)):bootbox.alert(n.Message)}function at(n){$.each(kt,function(){var t=$(this),i=t.find(":input");t.data("source-type")===n?(t.removeClass("hidden"),i.prop("disabled",!1)):(t.addClass("hidden"),i.prop("disabled",!0))})}function si(){const n=t.val();parseInt(n)===ft.Production?rt.collapse("show"):rt.collapse("hide");lt();v()}function hi(){Roblox.select2helpers.setupStandardSelect2(n,{width:"100%"});n.css("visibility","visible")}function ci(){Roblox.select2helpers.setupStandardSelect2(o,{width:"100%"});o.css("visibility","visible")}function li(){n.on("select2:close",function(){w()});t.change(function(){w()});w()}function w(){var e=n.val(),i=t.val(),r,f,u;(i==="0"||i==="-1")&&(i="");c.css("visibility","visible");r=ai(e,i);c.attr("href",r);f=$("#component :selected").text();u="Deployment history for "+f;c.text(u);l.css("visibility","visible");r=vi(e);l.attr("href",r);u="Component details for "+f;l.text(u)}function ai(n,t){return"/Deployments/History?TargetEnvironmentID="+t+"&ComponentID="+n}function vi(n){return"/Components/ComponentDetails/"+n}var b=$("#source-server-group"),n=$("#component"),e=$("#branchBuild"),k=$("#branchRelease"),t=$("#target-environment"),d=$("#target-environment option"),g=$("#source-environment"),vt=$("#source-server"),yt=$("#target-server"),o=$("#component-build"),pt=$("#component-build-by-release"),s=$("#buildartifact-error"),wt=$("#deploy-button"),bt=$("#enqueue-deployment-container"),i=$("#deployment-list"),h=$("#success-alert"),nt=$("#source-type"),kt=$("#source-types-container > div"),c=$("#historyLink"),l=$("#componentLink"),tt=$("#test-status"),it=$("#test-link"),rt=$("div#code-freeze-warning"),dt=$("p#client-lock-message"),gt=$("p#platform-lock-message"),ut=$("div#client-platform-lock-alert"),ni={Ok:1,Warning:2,Forbidden:3};const ti={Integration:2,Patch:3,master:4,PullRequest:5},ft={Production:1,SiteTest1:13,SiteTest2:14,SiteTest3:15};$(function(){$(document).ajaxError(function(n,t){t.status===401&&location.reload()});bootbox.setDefaults({animate:!1});i.on("click","button[data-current-deployment]",null,function(){Roblox.deploymentActions.currentDeploymentUpdate($(this),f,r)});i.on("click","a[data-current-deployment]",null,function(){Roblox.deploymentActions.currentDeploymentUpdate($(this),f,r)});i.on("click","button[data-redo-deployment]",null,function(){Roblox.deploymentActions.redoDeploymentUpdate($(this),f,r)});i.on("click","a[data-redo-deployment]",null,function(){Roblox.deploymentActions.redoDeploymentUpdate($(this),f,r)});wt.click(function(){var n;if(h.removeClass("in"),n=parseInt(t.val()),n===0){bootbox.alert("Please select a target environment to deploy");return}var i=!1,u=null,e=function(){var n=bt.find(":input").serialize(),t=$("#component-build option:selected").text();i&&(n+="&acknowledgedWarning=true");n+=`&artifactName=${t}`;$.post("/Deployments/EnqueueComponentAndDeployment",n).done(u).fail(r)},o=function(t,i){if(n===1){var u={warningTypeIndex:t,queued:i};$.post("/MetricsTracker/RecordDeploymentAttempt",u).done().fail(r)}};u=function(n){n.DeployPermission===ni.Warning?bootbox.confirm({message:n.Message,buttons:{confirm:{label:"Deploy anyway!",className:"btn-danger"},cancel:{label:"Cancel deploy",className:"btn-success"}},callback:function(t){if(!t){o(n.TestStatusDeploymentWarningType,!1);return}i=!0;o(n.TestStatusDeploymentWarningType,!0);e()}}):f(n)};bootbox.confirm("Are you sure you want to enqueue the deployment?",function(n){n&&e()})});var u=nt.val();at(u);nt.change(function(){var n=$(this).val();at(n)});b.change(oi);g.change(ct);t.change(si);n.change(p);e.change(function(){ot();ei()});o.change(function(){et($("#component-build option:selected").text(),e.val(),n.val(),function(n){y(n)})});k.change(st);p();hi();ci();li();a();v();setInterval(a,1e4);setInterval(v,1e4)})})